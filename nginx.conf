user root;
#worker_processes  1;
worker_processes auto;
worker_rlimit_nofile 204800;

#error_log /var/log/nginx/error.log;
#access_log /var/log/nginx/access.log;
#access_log /var/log/nginx/access.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;
pid /var/run/nginx.pid;

events {
  # worker_rlimit_nofile 204800;    #添加的
  worker_connections 204800;
}


http {
  include mime.types;
  default_type application/octet-stream;

  log_format main '$remote_addr - $remote_user [$time_local] "$request" '
  '$status $body_bytes_sent "$http_referer" '
  # 'Authorization:"$http_Authorization"'
  # '"$http_user_agent" "$http_x_forwarded_for"'
  '$request_time $upstream_response_time $upstream_addr';

  access_log /var/log/nginx/access.log main;
  proxy_set_header X-Forwarded-For $remote_addr;

  sendfile on;
  tcp_nopush on;
  tcp_nodelay on;
  # keepalive_timeout   65;
  types_hash_max_size 2048;
  client_max_body_size 1024M;

  #keepalive_timeout  0;
  keepalive_timeout 165;
  map $http_upgrade $connection_upgrade {
    default upgrade;
    '' close;
  }

  upstream rdb-backend {
    server 10.10.103.157:8000;
    # server 172.17.238.25:8000;
  }

  upstream dstack {
    server 10.10.102.221:8081;
    #     server 172.17.238.88:8081;
  }


  gzip on;
  gzip_proxied any;
  gzip_types
  text/css
  text/javascript
  text/xml
  text/plain
  application/javascript
  application/x-javascript
  application/json;
  server {
    listen 80 default_server;
    server_name ecmc;
    root /root/ecmcMicro/pub;
    proxy_set_header Host $host;
    client_max_body_size 1024m; #devops

    client_body_timeout 300s;
    client_header_timeout 300s;
    send_timeout 300s;
    keepalive_timeout  300s;

    proxy_send_timeout 300s;     # 设置发送超时时间
    proxy_read_timeout 300s;	 # 设置读取超时时间
    proxy_connect_timeout 300s;

    
    location / {
      root /root/ecmcMicro/pub/portal/;
      if ($request_filename ~* .*\.(?:htm|html|json)$) {
        add_header Cache-Control "private, no-store, no-cache, must-revalidate, proxy-revalidate";
      }
      try_files $uri /index.html;
    }

    # location  /sfsassui/ {
    #    proxy_pass http://10.85.205.74/iot/;
    # }


    location ~ ^/(/portal/spamicro|/portal/rdb|spamicro|/portal/tsfm|tsfm|/portal/doc|doc) {
      if ($request_filename ~* .*\.(?:htm|html|json)$) {
        add_header Cache-Control "private, no-store, no-cache, must-revalidate, proxy-revalidate";
      }
      location ~ ^/tsfmStatic/ {
	      root /root/ecmcMicro/pub/tsfm;
        # proxy_pass http://10.10.103.157/tsfm/tsfmStatic/;
      }
       location ~ ^/docStatic/ {
	      root /root/ecmcMicro/pub/doc;
      }
      try_files $uri /portal/index.html;
    }
	
	#sonar 代理
	location /api/projects/ {
      proxy_pass http://10.10.103.156:9000/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
	location /api/components/ {
      proxy_pass http://10.10.103.156:9000/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
	location /api/project_branches/ {
      proxy_pass http://10.10.103.156:9000/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
	location /api/issues/ {
      proxy_pass http://10.10.103.156:9000/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
	location /api/project_analyses/ {
      proxy_pass http://10.10.103.156:9000/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }


    # grafana 代理内容
    location ^~ /hc-devops/grafana/api {
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection $connection_upgrade;
      proxy_pass http://10.10.103.229:33193;
    }
    location ~* /hc-devops/grafana/.*\.(html|gif|jpg|jpeg|png|svg|css|js|ico)$ {
      add_header Access-Control-Allow-Origin *;
      add_header Access-Control-Allow-Methods 'GET, POST, PUT, DELETE, OPTIONS';
      add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';

      proxy_set_header Host $host:$server_port;
      proxy_redirect off;
      rewrite ^/hc-devops/grafana/(.*)$ /$1 break;
      proxy_pass http://10.10.103.229:33193;
    }
    location ~* /grafana/grafana/.*\.(html|gif|jpg|jpeg|png|svg|css|js|ico)$ {
      add_header Access-Control-Allow-Origin *;
      add_header Access-Control-Allow-Methods 'GET, POST, PUT, DELETE, OPTIONS';
      add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';

      proxy_set_header Host $host:$server_port;
      proxy_redirect off;
      rewrite ^/grafana/grafana/(.*)$ /$1 break;
      proxy_pass http://10.10.103.229:33193;
    }

    #grafana内容代理
    location ^~ /grafana/api {
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection $connection_upgrade;
      proxy_pass http://10.10.103.229:33193;
    }

    location ~* /grafana/.*\.(html|gif|jpg|jpeg|png|svg|css|js|ico)$ {
      add_header Access-Control-Allow-Origin *;
      add_header Access-Control-Allow-Methods 'GET, POST, PUT, DELETE, OPTIONS';
      add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';

      proxy_set_header Host $host:$server_port;
      proxy_redirect off;
      rewrite ^/grafana/(.*)$ /$1 break;
      proxy_pass http://10.10.103.229:33193;
    }

    # 工作流代理
    location ^~  /api/hc-workflow {
      proxy_http_version 1.1;
      proxy_set_header Connection "";
      rewrite ^/api/hc-workflow/(.*)$ /$1 break;
      proxy_pass http://10.10.103.229:33243;
    }

    # location ~* /workflow/.*\.(html|gif|jpg|jpeg|png|svg|css|js|ico|woff|json)$ {
    #   proxy_set_header Host $host:$server_port;
    #   proxy_redirect off;
    #   rewrite ^/workflow/(.*)$ /$1 break;
    #   proxy_pass http://10.10.103.229:33259;
    # }

    location ~* /hc-workflow/.*\.(html|gif|jpg|jpeg|png|svg|css|js|ico)$ {
      proxy_set_header Host $host:$server_port;
      proxy_redirect off;
      rewrite ^/hc-workflow/(.*)$ /$1 break;
      # https的情况下需要删除proxy_pass
      proxy_pass http://10.10.103.229:33249;
    }

    location ^~ /processIframe {
      proxy_pass http://10.10.103.229:33249;
    }

    location ^~ /taskIframe {
      proxy_pass http://10.10.103.229:33249;
    }

    #下载
    location ^~ /minio {
      client_max_body_size 2048M;
      proxy_http_version 1.1;
      proxy_set_header Connection "";
      rewrite ^/minio/(.*)$ /$1 break;
      proxy_pass http://10.10.103.229:33083;
    }
    location ~* /knowledge/vditor.*\.(html|gif|jpg|jpeg|png|svg|css|js|ico)$ {
      add_header Cache-Control no-cache;
      proxy_set_header Host $host:$server_port;
      proxy_redirect off;
      proxy_pass http://10.10.103.229:33132;
    }
    #原型ngnix代理
    location ~* /hc-devops/nginx.*\.(html|gif|jpg|jpeg|png|svg|css|js|ico)$ {
      add_header Cache-Control no-cache;
      proxy_set_header Host $host:$server_port;
      proxy_redirect off;
      rewrite ^/hc-devops/nginx/(.*)$ /$1 break;
      proxy_pass http://10.10.103.229:33260;
    }



    location ~ ^/(404|403|opt-center|hc-devops|uba|loginsight|aub|gyt|app|tsdb|gent|logx|login|auth-callback|register|task-output|big-screen|kafka|dstor|rds|redis|mongodb|es|rdb|ams|job|mon|ccp|dlb|metal|zstack|service|devops|mis|crds|gateway|srm|ticket|label|sfsassui|console|deploy|bill|change-password|requisition|aqd|realm|form|dcr|bml|block) {
      if ($request_filename ~* .*\.(?:htm|html|json)$) {
        add_header Cache-Control "private, no-store, no-cache, must-revalidate, proxy-revalidate";
      }
      try_files $uri /layout/index.html;
    }

    location ~ ^/(static|layout|systemConfig)/ {
      root /root/ecmcMicro/pub;
      if ($request_filename ~* .*\.(?:htm|html|json)$) {
        add_header Cache-Control "private, no-store, no-cache, must-revalidate, proxy-revalidate";
      }
    }
    location ~ ^/core-app {
      try_files $uri /core-app/index.html;
    }
    location ~ ^/caas-ui-harbor-app {
      try_files $uri /caas-ui-harbor-app/index.html;
    }
    location ~ ^/core {
      try_files $uri /core/index.html;
    }
    location ~ ^/caas-ui-harbor {
      try_files $uri /caas-ui-harbor/index.html;
    }
    location ~ ^/caas-ui-tenant {
      try_files $uri /caas-ui-tenant/index.html;
    }
    location /view {
      alias /root/ecmcMicro/pub/core/view;
    }
    location /template {
      alias /root/ecmcMicro/pub/core/template;
    }
    location /images {
      alias /root/ecmcMicro/pub/core/images;
    }
    location /pages {
      alias /root/ecmcMicro/pub/core/pages;
    }
    location /terminal {
      alias /root/ecmcMicro/pub/core/terminal;
      index index.html;
    }
    location ^~ /hc-devops/static {
      client_max_body_size 2048M;
      proxy_http_version 1.1;
      proxy_set_header Connection "";
      # rewrite ^/hc-devops/(.*)$ /$1 break;
      proxy_pass http://10.10.103.229:33132;
    }

    location ^~ /api {
      client_max_body_size 2048M;
      proxy_http_version 1.1;
      proxy_set_header Connection "";
      rewrite ^/api/(.*)$ /$1 break;
      proxy_pass http://10.10.103.229:33195;
    }

    location /api/data {
      proxy_pass http://172.17.247.65:8080;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      chunked_transfer_encoding off;
    }
    location /ark {
      proxy_pass http://10.10.103.99:9090;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      chunked_transfer_encoding off;
    }
    location ^~ /logx/api/v1/ {
      proxy_pass http://172.17.238.149:8006/logx/api/v1/;
    }
    location ^~ /logx-stream/api/v1 {
      proxy_pass http://172.17.238.151:8008/logx-stream/api/v1/;
    }
    location /bigdata_cloud_agent_manager_test/agent-manager/api/v1 {
      proxy_pass http://172.17.238.145:8006/agent-manager/;
      rewrite "^/bigdata_cloud_agent_manager_test/(.*)$" /$1 break;
    }
    location /api/loginsight {
      proxy_pass http://172.17.238.140:9600/logi;
    }


    location /api/data/external/cate/tree {
      proxy_pass http://172.17.247.39/api/platform/cates/tree?kind=4&$query_string;
      proxy_set_header x-user-token fe1393f8c82f5cc35b2c6f4e3946e072;
    }
    location /portal/v3/rdb {
      proxy_set_header X-Forwarded-For $remote_addr;
      proxy_pass http://10.10.103.157:8000;
      rewrite ^/portal(.*)$ $1 break;
    }
    location /v3/rdb {
      proxy_set_header X-Forwarded-For $remote_addr;
      proxy_pass http://10.10.103.157:8000;
    }
	
	location /v1/rdb {
      proxy_set_header X-Forwarded-For $remote_addr;
	  add_header Access-Control-Allow-Origin * always;
      proxy_pass http://rdb-backend;
    }
	
    location /isc_sso {
      proxy_set_header X-Forwarded-For $remote_addr;
      proxy_pass http://10.10.103.157:50001;
    }
    location /api/rdb {
	  proxy_http_version 1.1;
      proxy_set_header X-Forwarded-For $remote_addr;
	  proxy_set_header Upgrade $http_upgrade;
	  proxy_set_header Connection "upgrade";
      proxy_pass http://rdb-backend;
    }
    location /api/billing {
      proxy_pass http://10.10.103.157:8001;
    }
    location /v1/billing {
      proxy_pass http://10.10.103.157:8001;
    }
    location /api/ams {
      proxy_pass http://172.17.238.24:8000;
      #proxy_pass http://172.17.247.83:8080;
    }

    location /api/ams-ce {
      proxy_pass http://172.17.238.24:8000;
      #proxy_pass http://172.17.247.83:8080;
    }

    location /api/ams-ee {
      #proxy_pass http://172.17.238.24:8036;
      proxy_pass http://172.17.247.83:8080;
    }

    location /api/mon-ee {
      #proxy_pass http://172.17.238.24:8034;
      proxy_pass http://172.17.247.83:8080;
    }

    location /api/mon {
      proxy_pass http://127.0.0.1:8000;
      #proxy_pass http://172.17.247.83:8080;
    }
    location /api/job-ce {
      #proxy_pass http://172.17.238.24:8000;
      proxy_pass http://127.0.0.1:8000;
    }

    location /api/transfer {
      proxy_pass http://172.17.238.24:8000;
    }

    location /api/index {
      proxy_pass http://172.17.238.24:8012;
    }

    location /api/ccp {
      proxy_pass http://172.17.238.42:8066;
    }

    location /api/screen {
      proxy_pass http://172.17.247.15:8063;
    }

    location /api/ccpapi {
      proxy_pass http://172.17.247.39:8066;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection $connection_upgrade;
    }

    location /api/kube/v1 {
      proxy_pass http://10.10.102.221:8068;
    }

    location /api/image/v1 {
      proxy_pass http://172.17.238.24:8003;
    }

    location /api/ipam {
      proxy_pass http://172.17.247.75:7930;
    }
    location /api/ticket {
      proxy_pass http://127.0.0.1:8068;
    }

    location /v3/rdb/auth/callbackws {
      proxy_pass http://10.10.103.157:8000;
    }

    location /api/dlb {
      #proxy_pass http://172.17.238.24:8080;
      proxy_pass http://172.17.247.83:8080;
    }
    location /api/gateway {
      #proxy_pass http://172.17.247.68:8082;
      proxy_pass http://127.0.0.1:8082;
    }

    location /api/market {
      #proxy_pass http://172.17.247.68:8084;
      proxy_pass http://127.0.0.1:8084;
    }
    location /api/rds {
      proxy_pass http://172.17.247.48:8009;
    }
    location /api/metal/ {
      proxy_pass http://dstack/;
    }
    location /dicloud/s3/ {
      #proxy_pass http://172.17.238.24:8080;
      proxy_pass http://10.10.103.38:8080;
    }
    location /admin/s3/ {
      proxy_pass http://10.10.103.38:8080;
    }
	
    location /api/portal/acd {
      proxy_pass http://10.10.103.157:8078;
    }
    location /dicloud/ {
      #proxy_pass http://172.17.238.24:8080;
      proxy_pass http://10.10.103.38:8080;
    }
    #location /api/data/service {
    #    proxy_pass http://10.85.233.20:8080;
    #}
    location /api/platform {
      #proxy_pass http://10.10.103.157:7980/api/platform;
      proxy_pass http://10.10.103.157:7980;
      #proxy_pass http://172.17.247.83:8080;
    }
    location /v1/platform {
      #proxy_pass http://10.10.103.157:7980/api/platform;
      proxy_pass http://10.10.103.157:7980;
      #proxy_pass http://172.17.247.83:8080;
    }

    location /api/fireplate {
      proxy_pass http://172.17.238.24:8016;
    }

    location /api/redis {
      proxy_pass http://172.17.238.54:8888;
    }

    location /api/v1 {
      proxy_pass http://172.17.238.24:8094;
    }

    location /api/v2 {
      proxy_pass http://172.17.238.24:8094;
    }

    location ^~ /zstack/v1/ {
      proxy_pass http://dstack;
    }

    location /api/mongo/ {
      proxy_pass http://172.17.238.53:8010;
    }
    #location /fonts/ {
    # alias /root/ecmcMicro/pub/fonts/;
    #}
    location /tinymce/ {
      alias /root/ecmcMicro/pub/tinymce/;
      autoindex on;
    }

    location ^~ /service/ {
      proxy_pass http://172.17.247.87;
    }

    location = /service/ {
      rewrite /service/ /service/service;
    }

    location /nacos/ {
      proxy_pass http://172.17.247.87;
    }
    location ^~ /kafka/api/v1 {
      proxy_pass http://172.17.247.47:8000;
    }

    location /api/es/admin/ {
      proxy_pass http://172.17.247.61:8888;
    }
    location /api/es/ams/ {
      proxy_pass http://172.17.247.62:8888;
    }
    location /api/es/gateway/ {
      set $xAuthHeader 'Basic $cookie_Authorization';
      proxy_set_header Authorization $xAuthHeader;
      proxy_pass_request_headers on;
      proxy_cache_bypass $http_pragma $http_authorization;
      rewrite ^/api/es/gateway/(.*)$ /$1 break;
      proxy_pass http://172.17.247.63:8200;
    }
    location /api/es/kibana {
      set $xAuthHeader 'Basic $cookie_Authorization';
      proxy_set_header Authorization $xAuthHeader;
      proxy_pass_request_headers on;
      proxy_cache_bypass $http_pragma $http_authorization;
      rewrite ^/api/es/kibana/(.*) /$1 break;
      proxy_pass http://10.10.102.221:5601;
    }
    location ^~ /console/arius/kibana7 {
      set $xAuthHeader 'Basic $cookie_Authorization';
      proxy_set_header Authorization $xAuthHeader;
      proxy_pass_request_headers on;
      proxy_cache_bypass $http_pragma $http_authorization;
      rewrite ^/console/arius/kibana7/(.*) /$1 break;
      proxy_pass http://10.10.102.221:5601;
    }

    location /api/manager {
      proxy_pass http://10.86.247.19:8084;
    }
    location /api/oesaas/ {
      #         proxy_pass http://172.17.247.100:8067/;
      proxy_pass http://172.17.238.90:30190/;
    }
    location /api/logoesaas/ {
      proxy_pass http://172.17.247.100:8088/;
    }
    location /api/wsoesaas/ {
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection $connection_upgrade;
      proxy_pass http://172.17.247.100:8067/;
    }
    location /api/wslogoesaas/ {
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection $connection_upgrade;
      proxy_pass http://172.17.247.100:8088/;
    }

    location ^~ /label/ {
      # proxy_set_header Host   $http_host;
      # proxy_set_header X-Real-IP      $remote_addr;
      # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      # proxy_set_header X-Forwarded-Proto $scheme;
      # chunked_transfer_encoding       off;
      # proxy_set_header Cookie $http_cookie;
      # #proxy_cookie_domain 10.86.247.70:3000 nginx.server;
      #proxy_redirect off;
      proxy_pass http://10.86.247.70:3000;
    }

    location = /label/ {
      rewrite /label/ /label/label;
    }
    location ~ ^/(wsdm|zipkin)/ {
      proxy_pass http://172.17.247.87;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      chunked_transfer_encoding off;
    }


    location /api/bdlbiz {
      proxy_pass http://10.85.233.33:8138;
    }
    location /api/bml {
      proxy_pass http://10.85.233.33:8138;
    }
    location /api/mf {
      proxy_pass http://10.85.233.33:8138;
    }
    location ^~ /sfsassui/ {
      proxy_pass http://172.17.226.26;
    }
    location = /sfsassui/ {
      rewrite /sfsassui/ /sfsassui/sfsassui;
    }
    location ^~ /isolator/ {
      proxy_pass http://172.17.247.83:22555/;
    }
    location = /isolator/ {
      rewrite /isolator/ /isolator/isolator;
    }
    location ^~ /domain/ {
      proxy_pass http://172.17.247.115:22556/;
    }

    location = /domain/ {
      rewrite /domain/ /domain/domain;
    }
    location ^~ /form/ {
      proxy_pass http://172.17.247.62:22557/;
    }

    location = /form/ {
      rewrite /form/ /form/form;
    }
    location = /block-api/ {
      rewrite /block-api/ /block-api/block-api;
    }
    location ^~ /block-api/ {
      proxy_pass http://172.17.133.47:30000/;
    }


    location /mesh/ {
      proxy_pass https://10.10.104.73/mesh/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    location /oamapi/ {
      proxy_pass https://10.10.104.73;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    location /user {
      proxy_pass https://10.10.104.73/user;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    location /caas/ {
      proxy_pass https://10.10.104.73/caas/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    location /caascore/ {
      proxy_pass https://10.10.104.73;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    location /caasapi/ {
      proxy_pass https://10.10.104.73/caasapi/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    location /wscaas/ {
      proxy_pass https://10.10.104.73;
      proxy_http_version 1.1;
      proxy_connect_timeout 30m;
      proxy_read_timeout 30m;
      proxy_send_timeout 30m;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    location /gateway/ {
      proxy_pass https://10.10.104.73/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    location /registry/ {
      proxy_pass https://10.10.104.73/registry/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
	
    error_page 404 /404.html;
    location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
    }


  }
  server {
    listen 8233;
    root /root/ecmcMicro/memory;
    proxy_set_header Host $host;
    client_max_body_size 1024m;
    location / {
      root /root/ecmcMicro/memory/main;
      try_files $uri /index.html;
    }
    location ~ ^/dac {
      try_files $uri /dac/index.html;
    }
    location ~ ^/caas-ui-harbor-memory {
      try_files $uri /caas-ui-harbor-memory/index.html;
    }
    location ~ ^/core-memory {
      try_files $uri /core/index.html;
    }
    location ~ ^/caas-ui-harbor {
      try_files $uri /caas-ui-harbor/index.html;
    }
    location ~ ^/caas-ui-tenant {
      try_files $uri /caas-ui-tenant/index.html;
    }
    location /view {
      alias /root/ecmcMicro/memory/core-memory/view;
    }
    location /template {
      alias /root/ecmcMicro/memory/core-memory/template;
    }
    location /images {
      alias /root/ecmcMicro/memory/core-memory/images;
    }
    location /pages {
      alias /root/ecmcMicro/memory/core-memory/pages;
    }
    location /terminal {
      alias /root/ecmcMicro/memory/core-memory/terminal;
      index index.html;
    }
    # 以下是接口转发
    location /api/rdb {
      proxy_set_header X-Forwarded-For $remote_addr;
      proxy_pass http://rdb-backend;
    }
	
    location /user {
      proxy_pass https://10.10.104.73/user;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    location /caas/ {
      proxy_pass https://10.10.104.73/caas/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    location /api/platform {
      proxy_pass https://10.10.104.73/gongxu/api/platform/;
    }
    location /api/billing {
      proxy_pass https://10.10.104.73/gongxu/api/billing/;
    }
    location /api/portal {
      proxy_pass https://10.10.104.73/gongxu/api/portal/;
    }
    location /prod-url/ {
      proxy_pass https://10.10.104.73/hechu/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
  }
  server {
    listen 8234;
    root /root/ecmcMicro/legal;
    proxy_set_header Host $host;
    location / {
      try_files $uri /index.html;
    }
    # 以下是接口转发
    location /prod-url/ {
      proxy_pass http://10.10.103.157:17981/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
  }

  server {
    listen 33009;
    root /root/ecmcMicro/seal;
    proxy_set_header Host $host;
    location / {
      try_files $uri /index.html;
    }
    # 以下是接口转发
    location /sealManageService-caas/ {
      proxy_pass http://10.10.104.73:33009/;
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
  }
}

